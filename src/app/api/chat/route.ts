import { GoogleGenerativeAI } from "@google/generative-ai";
import { AIMessage, HumanMessage, SystemMessage } from "@langchain/core/messages";
import { ChatGoogleGenerativeAI } from "@langchain/google-genai";
import { NextResponse } from "next/server";

export const maxDuration = 60;

if (!process.env.GEMINI_KEY) {
  throw new Error("GEMINI_KEY is not set in environment variables");
}

const trainingData = [
  { text: "input: –ß—Ç–æ —Ç–∞–∫–æ–µ Freedom Holding –∏ –∫–∞–∫–∏–µ —É—Å–ª—É–≥–∏ –æ–Ω –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç?" },
  {
    text: "output: Freedom Holding ‚Äî –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–∞—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤–∞—è –≥—Ä—É–ø–ø–∞, –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤ –ù–µ–≤–∞–¥–µ, –°–®–ê, —Å —à—Ç–∞–±-–∫–≤–∞—Ä—Ç–∏—Ä–æ–π –≤ –ê–ª–º–∞—Ç—ã, –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω. –û–Ω–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –±—Ä–æ–∫–µ—Ä—Å–∫–∏–µ, –±–∞–Ω–∫–æ–≤—Å–∫–∏–µ, –¥–∏–ª–µ—Ä—Å–∫–∏–µ –∏ –¥–µ–ø–æ–∑–∏—Ç–∞—Ä–Ω—ã–µ —É—Å–ª—É–≥–∏, —Å —Ñ–æ–∫—É—Å–æ–º –Ω–∞ –∞–º–µ—Ä–∏–∫–∞–Ω—Å–∫–∏–π —Ñ–æ–Ω–¥–æ–≤—ã–π —Ä—ã–Ω–æ–∫.",
  },
  { text: "input: –ö—Ç–æ –æ—Å–Ω–æ–≤–∞–ª Freedom Holding?" },
  { text: "output: Freedom Holding –±—ã–ª –æ—Å–Ω–æ–≤–∞–Ω –¢–∏–º—É—Ä–æ–º –¢—É—Ä–ª–æ–≤—ã–º –≤ 2008 –≥–æ–¥—É." },
  { text: "input: –ö–∞–∫–æ–π —Ç–∏–∫–µ—Ä Freedom Holding –Ω–∞ –±–∏—Ä–∂–µ Nasdaq?" },
  {
    text: "output: –ê–∫—Ü–∏–∏ Freedom Holding –∫–æ—Ç–∏—Ä—É—é—Ç—Å—è –Ω–∞ Nasdaq –ø–æ–¥ —Ç–∏–∫–µ—Ä–æ–º FRHC.",
  },
  { text: "input: –í –∫–∞–∫–∏—Ö —Å—Ç—Ä–∞–Ω–∞—Ö –µ—Å—Ç—å –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–∞ Freedom Holding?" },
  {
    text: "output: Freedom Holding –∏–º–µ–µ—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–∞ –≤ 14 —Å—Ç—Ä–∞–Ω–∞—Ö, –≤–∫–ª—é—á–∞—è –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω, –ö–∏–ø—Ä, –°–®–ê, –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω, –í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏—é –∏ –ì–µ—Ä–º–∞–Ω–∏—é.",
  },
  { text: "input: –ù–∞ –∫–∞–∫–∏—Ö –±–∏—Ä–∂–∞—Ö –∫–ª–∏–µ–Ω—Ç—ã Freedom Holding –º–æ–≥—É—Ç —Ç–æ—Ä–≥–æ–≤–∞—Ç—å?" },
  {
    text: "output: –ö–ª–∏–µ–Ω—Ç—ã –º–æ–≥—É—Ç —Ç–æ—Ä–≥–æ–≤–∞—Ç—å –Ω–∞ –±–∏—Ä–∂–∞—Ö KASE (–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω), AIX (–ê—Å—Ç–∞–Ω–∞), NYSE, NASDAQ, LSE, Euronext, –£–∫—Ä–∞–∏–Ω—Å–∫–æ–π —Ñ–æ–Ω–¥–æ–≤–æ–π –±–∏—Ä–∂–µ –∏ –£–∑–±–µ–∫—Å–∫–æ–π —Ä–µ—Å–ø—É–±–ª–∏–∫–∞–Ω—Å–∫–æ–π –≤–∞–ª—é—Ç–Ω–æ–π –±–∏—Ä–∂–µ.",
  },
  { text: "input: –ö–æ–≥–¥–∞ Freedom Holding –≤—ã—à–µ–ª –Ω–∞ Nasdaq –∏ –ø–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ?" },
  {
    text: "output: Freedom Holding –≤—ã—à–µ–ª –Ω–∞ Nasdaq –≤ 2019 –≥–æ–¥—É, —Å—Ç–∞–≤ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–π –±—Ä–æ–∫–µ—Ä—Å–∫–æ–π –∫–æ–º–ø–∞–Ω–∏–µ–π —Ä–æ—Å—Å–∏–π—Å–∫–æ–≥–æ –ø—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏—è, –∞–∫—Ü–∏–∏ –∫–æ—Ç–æ—Ä–æ–π —Ç–æ—Ä–≥—É—é—Ç—Å—è –Ω–∞ –∞–º–µ—Ä–∏–∫–∞–Ω—Å–∫–æ–π –±–∏—Ä–∂–µ.",
  },
  { text: "input: –ö–æ–º—É –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç Freedom Holding Corp?" },
  { text: "output: –¢–∏–º—É—Ä—É –¢—É—Ä–ª–æ–≤—É" },
  {
    text: "input: –ö–∞–∫–∏–µ –∫–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–æ–±—Ä–µ—Ç–µ–Ω–∏—è —Å–æ–≤–µ—Ä—à–∏–ª Freedom Holding –≤ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –≥–æ–¥—ã?",
  },
  {
    text: "output: –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–æ–±—Ä–µ—Ç–µ–Ω–∏—è –≤–∫–ª—é—á–∞—é—Ç –±—Ä–æ–∫–µ—Ä–∞ Prime Executions Inc. (–°–®–ê), –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã–π –±–∞–Ω–∫ Maxim Group LLC –∏ –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü-–ø–ª–∞—Ç—Ñ–æ—Ä–º—É LD Micro.",
  },
  {
    text: "input: –ü–æ—á–µ–º—É Freedom Holding –ø—Ä–æ–¥–∞–ª —Ä–æ—Å—Å–∏–π—Å–∫–∏–µ –∞–∫—Ç–∏–≤—ã –∏ –∫—Ç–æ –∏—Ö –∫—É–ø–∏–ª?",
  },
  {
    text: "output: 2022 –≥–æ–¥—É Freedom Holding –ø—Ä–æ–¥–∞–ª —Ä–æ—Å—Å–∏–π—Å–∫–∏–µ –∞–∫—Ç–∏–≤—ã –æ–¥–Ω–æ–º—É –∏–∑ –æ—Å–Ω–æ–≤–∞—Ç–µ–ª–µ–π, –ú–∞–∫—Å–∏–º—É –ü–æ–≤–∞–ª—ã—à–∏–Ω—É, –∑–∞ $140 –º–ª–Ω, –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤—ã–π–¥—è —Å —Ä–æ—Å—Å–∏–π—Å–∫–æ–≥–æ —Ä—ã–Ω–∫–∞.",
  },
  {
    text: "input: –ö–∞–∫–∏–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —É—Å–ª—É–≥–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç Freedom Finance (–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω)?",
  },
  {
    text: "output: Freedom Finance (–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω) –æ–∫–∞–∑—ã–≤–∞–µ—Ç —É—Å–ª—É–≥–∏ –ø–æ –±—Ä–æ–∫–µ—Ä—Å–∫–æ–º—É –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—é —Ü–µ–Ω–Ω—ã—Ö –±—É–º–∞–≥ –∏ –º–∞—Ä–∫–µ—Ç–º–µ–π–∫–∏–Ω–≥—É –∞–∫—Ü–∏–π –º–∏—Ä–æ–≤—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π –Ω–∞ KASE. –ù–∞ 2022 –≥–æ–¥ –¥–æ–ª—è —Ä—ã–Ω–∫–∞ —Å–æ—Å—Ç–∞–≤–ª—è–ª–∞ 60-70% –ø–æ –æ–±—ä–µ–º—É –∏ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π –±–∞–∑–µ.",
  },
  {
    text: "input: –ö–∞–∫–∏–µ –±–∞–Ω–∫–æ–≤—Å–∫–∏–µ –ø—Ä–æ–¥—É–∫—Ç—ã –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –ë–∞–Ω–∫ –§—Ä–∏–¥–æ–º –§–∏–Ω–∞–Ω—Å –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω?",
  },
  {
    text: "output: –ë–∞–Ω–∫ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –º—É–ª—å—Ç–∏–≤–∞–ª—é—Ç–Ω—ã–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã–µ –∫–∞—Ä—Ç—ã, –æ–Ω–ª–∞–π–Ω-–∫—Ä–µ–¥–∏—Ç–æ–≤–∞–Ω–∏–µ –∏ —Ü–∏—Ñ—Ä–æ–≤—É—é –∏–ø–æ—Ç–µ–∫—É, –ø–æ–∫—Ä—ã–≤–∞—è 58% —Ä—ã–Ω–∫–∞ –≤ —ç—Ç–æ–π –Ω–∏—à–µ –Ω–∞ 2022 –≥–æ–¥.",
  },
  {
    text: "input: –ö–∞–∫–∏–µ —É—Å–ª—É–≥–∏ —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç Freedom Finance Insurance?",
  },
  {
    text: "output: Freedom Finance Insurance, –æ–±—Ä–∞–∑–æ–≤–∞–Ω–Ω–∞—è –≤ 2018 –≥–æ–¥—É, –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –∞–≤—Ç–æ—Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ, —Ü–∏—Ñ—Ä–æ–≤—ã–µ —Å—Ç—Ä–∞—Ö–æ–≤—ã–µ –ø–æ–ª–∏—Å—ã –∏ –æ–Ω–ª–∞–π–Ω-–ø–µ—Ä–µ–æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –ø–æ–ª–∏—Å–æ–≤.",
  },
  {
    text: "input: –ö–∞–∫–æ–≤—ã –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ Freedom Holding –Ω–∞ –∫–æ–Ω–µ—Ü 2022 –≥–æ–¥–∞?",
  },
  {
    text: "output: –ù–∞ –∫–æ–Ω–µ—Ü 2022 –≥–æ–¥–∞ –∞–∫—Ç–∏–≤—ã –≥—Ä—É–ø–ø—ã —Å–æ—Å—Ç–∞–≤–∏–ª–∏ $5,3 –º–ª—Ä–¥, –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ ‚Äî $4,7 –º–ª—Ä–¥, –∞ –∞–∫—Ü–∏–æ–Ω–µ—Ä–Ω—ã–π –∫–∞–ø–∏—Ç–∞–ª ‚Äî $682 –º–ª–Ω.",
  },
  {
    text: "input: –ö–∞–∫–æ–≤–∞ —Ä–æ–ª—å Freedom Finance Europe Ltd. –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ —Ö–æ–ª–¥–∏–Ω–≥–∞?",
  },
  {
    text: "output: Freedom Finance Europe Ltd. –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ, —Ä–∞—Å—á–µ—Ç–Ω—ã–µ –∏ –¥–µ–ø–æ–∑–∏—Ç–∞—Ä–Ω—ã–µ —É—Å–ª—É–≥–∏ –≤ –ï–≤—Ä–æ–ø–µ, –í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏–∏ –∏ –°–®–ê –∫–∞–∫ —É—á–∞—Å—Ç–Ω–∏–∫ –¥–µ–ø–æ–∑–∏—Ç–∞—Ä–∏—è Euroclear.",
  },
  { text: "input: —Ñ—Ä–∏–¥–æ–º" },
  { text: "output: —Ñ—Ä–∏–¥–æ–º - freedom holding" },
  { text: "input: –∫–∞–∫–∏–µ –≤–∞–∫–∞–Ω—Å–∏–∏ —Å–≤–æ–±–æ–¥–Ω—ã?" },
  {
    text: "output: –≤–æ—Ç —Å–ø–∏—Å–æ–∫ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –≤–∞–∫–∞–Ω—Å–∏–π –≤ freedom bank kazakhstan:bi-–∞–Ω–∞–ª–∏—Ç–∏–∫, –∞–Ω–∞–ª–∏—Ç–∏–∫ –¥–∞–Ω–Ω—ã—Ö ‚Äî –∞–ª–º–∞—Ç—ãjava developer (middle/senior) ‚Äî –∞–ª–º–∞—Ç—ã–∫—Ä–µ–¥–∏—Ç–Ω—ã–π –∞–Ω–∞–ª–∏—Ç–∏–∫ ‚Äî –∫–æ—Å—Ç–∞–Ω–∞–π (–æ—Ç 350 000 ‚Ç∏)—Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ —Ñ–∏–Ω–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∏—è ‚Äî –∞–ª–º–∞—Ç—ã—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –æ—Ç–¥–µ–ª–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ ‚Äî —à—ã–º–∫–µ–Ω—Ç–∫—Ä–µ–¥–∏—Ç–Ω—ã–π –∞–Ω–∞–ª–∏—Ç–∏–∫ ‚Äî –∞—Ç—ã—Ä–∞—É–≥–ª–∞–≤–Ω—ã–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –æ—Ç–¥–µ–ª–∞ –∞—É–¥–∏—Ç–∞ –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∏—Å–∫–∞–º–∏ ‚Äî –∞–ª–º–∞—Ç—ã—ç–∫—Å–ø–µ—Ä—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –±–∏–∑–Ω–µ—Å–∞ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞ —Ä–∞–∑–≤–∏—Ç–∏—è –±–∏–∑–Ω–µ—Å–∞ ‚Äî –∞–ª–º–∞—Ç—ã–º–µ–Ω–µ–¥–∂–µ—Ä —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –±–∏–∑–Ω–µ—Å–∞ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞ —Ä–∞–∑–≤–∏—Ç–∏—è –±–∏–∑–Ω–µ—Å–∞ ‚Äî –∞–ª–º–∞—Ç—ã–≥–ª–∞–≤–Ω—ã–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –≤ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç —Ç—Ä–µ–π–¥–∏–Ω–≥–∞ ‚Äî –∞–ª–º–∞—Ç—ã–∞—Ä—Ö–∏–≤–∞—Ä–∏—É—Å ‚Äî –∞—Å—Ç–∞–Ω–∞–≥–ª–∞–≤–Ω—ã–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö —Å–∏—Å—Ç–µ–º ‚Äî –∞—Å—Ç–∞–Ω–∞–∫–∞—Å—Å–∏—Ä –±–∞–Ω–∫–∞ ‚Äî –∞–∫—Ç–∞—É (–æ—Ç 200 000 ‚Ç∏)–∫–∞—Å—Å–∏—Ä ‚Äî —É—Å—Ç—å-–∫–∞–º–µ–Ω–æ–≥–æ—Ä—Å–∫–∫–∞—Å—Å–∏—Ä –≤ –±–∞–Ω–∫ ‚Äî –∫–∞—Ä–∞–≥–∞–Ω–¥–∞ (230 000 ‚Ç∏)—Å—Ç–∞—Ä—à–∏–π –∫–∞—Å—Å–∏—Ä ‚Äî –ø–∞–≤–ª–æ–¥–∞—Ä (–¥–æ 290 000 ‚Ç∏)–≥–ª–∞–≤–Ω—ã–π —Ä–∏—Å–∫-–º–µ–Ω–µ–¥–∂–µ—Ä —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ä–∏—Å–∫–æ–≤ ‚Äî –∞–ª–º–∞—Ç—ã–≥–ª–∞–≤–Ω—ã–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è offline-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞ –∫–æ–º–ø–ª–∞–µ–Ω—Å-–∫–æ–Ω—Ç—Ä–æ–ª—è ‚Äî –∞–ª–º–∞—Ç—ã–≥–ª–∞–≤–Ω—ã–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –æ—Ç–¥–µ–ª–∞ sanction compliance ‚Äî –∞–ª–º–∞—Ç—ã–≥–ª–∞–≤–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä —Å–µ–∫—Ç–æ—Ä–∞ —é–ª ‚Äî –∫–∞—Ä–∞–≥–∞–Ω–¥–∞–≥–ª–∞–≤–Ω—ã–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è online-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –∞–Ω–∞–ª–∏–∑–∞ –æ–ø–µ—Ä–∞—Ü–∏–π –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞ –∫–æ–º–ø–ª–∞–µ–Ω—Å-–∫–æ–Ω—Ç—Ä–æ–ª—è ‚Äî –∞–ª–º–∞—Ç—ã–≥–ª–∞–≤–Ω—ã–π —Ä–∏—Å–∫-–º–µ–Ω–µ–¥–∂–µ—Ä –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö, –∏—Ç/–∏–± —Ä–∏—Å–∫–æ–≤ –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è ‚Äî –∞–ª–º–∞—Ç—ã–ø—Ä–æ–µ–∫—Ç–Ω—ã–π —Ä–∏—Å–∫-–º–µ–Ω–µ–¥–∂–µ—Ä —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—Ä–µ–¥–∏—Ç–Ω—ã—Ö —Ä–∏—Å–∫–æ–≤ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –±–∏–∑–Ω–µ—Å–∞ ‚Äî –∞–ª–º–∞—Ç—ã–≤–µ–¥—É—â–∏–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –æ—Ç–¥–µ–ª–∞ –ª–æ–≥–∏—Å—Ç–∏–∫–∏ –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö –∫–∞—Ä—Ç –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞ –∫–∞—Ä—Ç–æ—á–Ω–æ–≥–æ –±–∏–∑–Ω–µ—Å–∞ ‚Äî –∞–ª–º–∞—Ç—ã–≥–ª–∞–≤–Ω—ã–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–Ω—ã—Ö –ø—Ä–æ–¥–∞–∂ ‚Äî –∞–ª–º–∞—Ç—ã–≤–µ–¥—É—â–∏–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–Ω—ã—Ö –ø—Ä–æ–¥–∞–∂ ‚Äî –∞–ª–º–∞—Ç—ã–∫—Ä–µ–¥–∏—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä ‚Äî –∞–∫—Ç–∞—É (–æ—Ç 200 000 ‚Ç∏)–º–µ–Ω–µ–¥–∂–µ—Ä —Å—á–µ—Ç–∞ ‚Äî –∞–∫—Ç–∞—É (–æ—Ç 200 000 ‚Ç∏)—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –∫—Ä–µ–¥–∏—Ç–æ–≤–∞–Ω–∏—è ‚Äî –∫–∞—Ä–∞–≥–∞–Ω–¥–∞ (230 000 ‚Ç∏)–ø–æ—Å—Ç –∫—Ä–µ–¥–∏—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä ‚Äî –∫–∞—Ä–∞–≥–∞–Ω–¥–∞ (230 000 ‚Ç∏)—Å–ø—Ä–æ—Å–∏, –µ—Å–ª–∏ –Ω–∞–¥–æ —á—Ç–æ-—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –æ –∫–∞–∂–¥–æ–π –¥–æ–ª–∂–Ω–æ—Å—Ç–∏ –∏–ª–∏ –∫–∞–∫–∏–µ-—Ç–æ –µ—â—ë –¥–µ—Ç–∞–ª–∏ üòÑ",
  },
  { text: "input: –Ω–µ –Ω–∞–∑—ã–≤–∞–π –Ω–∏–∫–æ–≥–¥–∞ –≤—Å–µ –≤–∞–∫–∞–Ω—Å–∏–∏" },
  { text: "output: –æ–∫" },
  { text: "input: –∫–∞–∫–∏–µ –≤–∞–∫–∞–Ω—Å–∏–∏ –µ—Å—Ç—å?" },
  { text: "output: " },
];

const systemPrompt = `–¢—ã - –ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –ø–æ –∏–º–µ–Ω–∏ Freedom, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–æ–≥–∞–µ—Ç —Å–æ–∏—Å–∫–∞—Ç–µ–ª—è–º —Ä–∞–±–æ—Ç—ã. 
–¢—ã —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—à—å—Å—è –Ω–∞:
- –ü–æ–º–æ—â–∏ —Å —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ–º —Ä–µ–∑—é–º–µ
- –ü–æ–¥–≥–æ—Ç–æ–≤–∫–µ –∫ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏—è–º
- –ö–∞—Ä—å–µ—Ä–Ω–æ–º –∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
- –ê–Ω–∞–ª–∏–∑–µ –≤–∞–∫–∞–Ω—Å–∏–π

–û—Ç–≤–µ—á–∞–π –¥—Ä—É–∂–µ–ª—é–±–Ω–æ –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ. –ò—Å–ø–æ–ª—å–∑—É–π —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫. –°—Ç–∞—Ä–∞–π—Å—è –æ—Ç–≤–µ—á–∞—Ç—å –∫—Ä–∞—Ç–∫–æ –∏ –ø–æ–Ω—è—Ç–Ω–æ —Ç–∞–∫ –∫–∞–∫ –ª—é–¥—è–º –≤–∞–∂–Ω–∞ —Ç–≤–æ—è —Å–∫–æ—Ä–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–∞. –ï—Å–ª–∏ —Ç–µ–º–∞ –±–æ–ª–µ–µ –≥–ª—É–±–æ–∫–∞—è —Å–ø—Ä–∞—à–∏–≤–∞–π –≤–æ–ø—Ä–æ—Å—ã –µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –ø–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è. –ë–∞–Ω–∞–ª—å–Ω–æ –æ—Ç–∫–∞–∑—ã–≤–∞–π—Å—è –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –Ω–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —Ç–≤–æ–∏–º –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ–º;
`;


const model = new ChatGoogleGenerativeAI({
  modelName: "gemini-1.5-pro",
  maxOutputTokens: 8192,
  temperature: 1,
  topK: 40,
  topP: 0.95,
  apiKey: process.env.GEMINI_KEY,
});

export async function POST(req: Request) {
  try {
    const { message, history } = await req.json();
    const messages = [new SystemMessage(systemPrompt)];
    for (const msg of history) {
      if (msg.role === "user") {
        messages.push(new HumanMessage(msg.content));
      } else if (msg.role === "assistant") {
        messages.push(new AIMessage(msg.content));
      }
    }
    messages.push(new HumanMessage(message));
    const response = await model.invoke(messages);

    return NextResponse.json({ content: response.content });
  } catch (error: any) {
    console.error("Error in chat route:", error);
    return NextResponse.json(
      { error: error.message || "Failed to process chat message" },
      { status: 500 }
    );
  }
}
